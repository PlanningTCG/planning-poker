(function(){var e;htmx.defineExtension("sse",{init:function(t){e=t,htmx.createEventSource==void 0&&(htmx.createEventSource=i)},getSelectors:function(){return["[sse-connect]","[data-sse-connect]","[sse-swap]","[data-sse-swap]"]},onEvent:function(t,n){var i,a,o=n.target||n.detail.elt;switch(t){case"htmx:beforeCleanupElement":i=e.getInternalData(o),a=i.sseEventSource,a&&(e.triggerEvent(o,"htmx:sseClose",{source:a,type:"nodeReplaced"}),i.sseEventSource.close());return;case"htmx:afterProcessNode":s(o)}}});function i(e){return new EventSource(e,{withCredentials:!0})}function n(n){if(e.getAttributeValue(n,"sse-swap")){var i,a,c,l,d,u,s=e.getClosestMatch(n,o);if(s==null)return null;for(a=e.getInternalData(s),i=a.sseEventSource,d=e.getAttributeValue(n,"sse-swap"),l=d.split(","),c=0;c<l.length;c++){const a=l[c].trim(),o=function(c){if(t(s))return;if(!e.bodyContains(n)){i.removeEventListener(a,o);return}if(!e.triggerEvent(n,"htmx:sseBeforeMessage",c))return;r(n,c.data),e.triggerEvent(n,"htmx:sseMessage",c)};e.getInternalData(n).sseEventListener=o,i.addEventListener(a,o)}}if(e.getAttributeValue(n,"hx-trigger")){if(s=e.getClosestMatch(n,o),s==null)return null;a=e.getInternalData(s),i=a.sseEventSource,u=e.getTriggerSpecs(n),u.forEach(function(o){if(o.trigger.slice(0,4)!=="sse:")return;var a=function(r){if(t(s))return;e.bodyContains(n)||i.removeEventListener(o.trigger.slice(4),a),htmx.trigger(n,o.trigger,r),htmx.trigger(n,"htmx:sseMessage",r)};e.getInternalData(n).sseEventListener=a,i.addEventListener(o.trigger.slice(4),a)})}}function s(t,s){if(t==null)return null;if(e.getAttributeValue(t,"sse-connect")){var o=e.getAttributeValue(t,"sse-connect");if(o==null)return;a(t,o,s)}n(t)}function a(o,i,a){var c,r=htmx.createEventSource(i);r.onerror=function(n){if(e.triggerErrorEvent(o,"htmx:sseError",{error:n,source:r}),t(o))return;if(r.readyState===EventSource.CLOSED){a=a||0,a=Math.max(Math.min(a*2,128),1);var i=a*500;window.setTimeout(function(){s(o,a)},i)}},r.onopen=function(){if(e.triggerEvent(o,"htmx:sseOpen",{source:r}),a&&a>0){const e=o.querySelectorAll("[sse-swap], [data-sse-swap], [hx-trigger], [data-hx-trigger]");for(let t=0;t<e.length;t++)n(e[t]);a=0}},e.getInternalData(o).sseEventSource=r,c=e.getAttributeValue(o,"sse-close"),c&&r.addEventListener(c,function(){e.triggerEvent(o,"htmx:sseClose",{source:r,type:"message"}),r.close()})}function t(t){if(!e.bodyContains(t)){var n=e.getInternalData(t).sseEventSource;if(n!=null)return e.triggerEvent(t,"htmx:sseClose",{source:n,type:"nodeMissing"}),n.close(),!0}return!1}function r(t,n){e.withExtensions(t,function(e){n=e.transformResponse(n,null,t)});var s=e.getSwapSpecification(t),o=e.getTarget(t);e.swap(o,n,s)}function o(t){return e.getInternalData(t).sseEventSource!=null}})()
